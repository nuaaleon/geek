<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.5;
  filter:Alpha(opacity=50);
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <p class="x">更多课程请加QQ1046877154，微信loveu_110获取</p>
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                11讲通道的高级玩法
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/1c/11/1c765950e3642867b2df2d839e67f711.jpg">


                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>我们已经讨论过了通道的基本操作以及背后的规则。今天，我再来讲讲通道的高级玩法。</p>
<p>首先来说说单向通道。我们在说“通道”的时候指的都是双向通道，即：既可以发也可以收的通道。</p>
<p>所谓单向通道就是，只能发不能收，或者只能收不能发的通道。一个通道是双向的，还是单向的是由它的类型字面量体现的。</p>
<p>还记得我们在上篇文章中说过的接收操作符<code>&lt;-</code>吗？如果我们把它用在通道的类型字面量中，那么它代表的就不是“发送”或“接收”的动作了，而是表示通道的方向。</p>
<p>比如：</p>
<pre><code>var uselessChan = make(chan&lt;- int, 1)
</code></pre>
<p>我声明并初始化了一个名叫<code>uselessChan</code>的变量。这个变量的类型是<code>chan&lt;- int</code>，容量是<code>1</code>。</p>
<p>请注意紧挨在关键字<code>chan</code>右边的那个<code>&lt;-</code>，这表示了这个通道是单向的，并且只能发而不能收。</p>
<p>类似的，如果这个操作符紧挨在<code>chan</code>的左边，那么就说明该通道只能收不能发。所以，前者可以被简称为发送通道，后者可以被简称为接收通道。</p>
<p>注意，与发送操作和接收操作对应，这里的“发”和“收”都是站在操作通道的代码的角度上说的。</p>
<p>从上述变量的名字上你也能猜到，这样的通道是没用的。通道就是为了传递数据而存在的，声明一个只有一端（发送端或者接收端）能用的通道没有任何意义。那么，单向通道的用途究竟在哪儿呢？</p><!-- [[[read_end]]] -->
<p><strong>问题：单向通道有什么应用价值？</strong></p>
<p>你可以先自己想想，然后再接着往下看。</p>
<p><strong>典型回答</strong></p>
<p>概括地说，单向通道最主要的用途就是约束其他代码的行为。</p>
<p><strong>问题解析</strong></p>
<p>这需要从两个方面讲，都跟函数的声明有些关系。先来看下面的代码：</p>
<pre><code>func SendInt(ch chan&lt;- int) {
	ch &lt;- rand.Intn(1000)
}
</code></pre>
<p>我用<code>func</code>关键字声明了一个叫做<code>SendInt</code>的函数。这个函数只接受一个<code>chan&lt;- int</code>类型的参数。在这个函数中的代码只能向参数<code>ch</code>发送元素值，而不能从它那里接收元素值。这就起到了约束函数行为的作用。</p>
<p>你可能会问，我自己写的函数自己肯定能确定操作通道的方式，为什么还要再约束？好吧，这个例子可能过于简单了。在实际场景中，这种约束一般会出现在接口类型声明中的某个方法定义上。请看这个叫<code>Notifier</code>的接口类型声明：</p>
<pre><code>type Notifier interface {
	SendInt(ch chan&lt;- int)
}
</code></pre>
<p>在接口类型声明的花括号中，每一行都代表着一个方法的定义。接口中的方法定义与函数声明很类似，但是只包含了方法名称、参数列表和结果列表。</p>
<p>一个类型如果想成为一个接口类型的实现类型，那么就必须实现这个接口中定义的所有方法。因此，如果我们在某个方法的定义中使用了单向通道类型，那么就相当于在对它的所有实现做出约束。</p>
<p>在这里，<code>Notifier</code>接口中的<code>SendInt</code>方法只会接受一个发送通道作为参数，所以，在该接口的所有实现类型中的<code>SendInt</code>方法都会受到限制。这种约束方式还是很有用的，尤其是在我们编写模板代码或者可扩展的程序库的时候。</p>
<p>顺便说一下，我们在调用<code>SendInt</code>函数的时候，只需要把一个元素类型匹配的双向通道传给它就行了，没必要用发送通道，因为Go语言在这种情况下会自动地把双向通道转换为函数所需的单向通道。</p>
<pre><code>intChan1 := make(chan int, 3)
SendInt(intChan1)
</code></pre>
<p>在另一个方面，我们还可以在函数声明的结果列表中使用单向通道。如下所示：</p>
<pre><code>func getIntChan() &lt;-chan int {
	num := 5
	ch := make(chan int, num)
	for i := 0; i &lt; num; i++ {
		ch &lt;- i
	}
	close(ch)
	return ch
}
</code></pre>
<p>函数<code>getIntChan</code>会返回一个<code>&lt;-chan int</code>类型的通道，这就意味着得到该通道的程序，只能从通道中接收元素值。这实际上就是对函数调用方的一种约束了。</p>
<p>另外，我们在Go语言中还可以声明函数类型，如果我们在函数类型中使用了单向通道，那么就相等于在约束所有实现了这个函数类型的函数。</p>
<p>我们再顺便看一下调用<code>getIntChan</code>的代码：</p>
<pre><code>intChan2 := getIntChan()
for elem := range intChan2 {
	fmt.Printf(&quot;The element in intChan2: %v\n&quot;, elem)
}
</code></pre>
<p>我把调用<code>getIntChan</code>得到的结果值赋给了变量<code>intChan2</code>，然后用<code>for</code>语句循环地取出了该通道中的所有元素值，并打印出来。</p>
<p>这里的<code>for</code>语句也可以被称为带有<code>range</code>子句的<code>for</code>语句。它的用法我在后面讲<code>for</code>语句的时候专门说明。现在你只需要知道关于它的三件事。</p>
<ul>
<li>一、这样一条<code>for</code>语句会不断地尝试从<code>intChan2</code>种取出元素值，即使<code>intChan2</code>被关闭，它也会在取出所有剩余的元素值之后再结束执行。</li>
<li>二、当<code>intChan2</code>中没有元素值时，它会被阻塞在有<code>for</code>关键字的那一行，直到有新的元素值可取。</li>
<li>三、假设<code>intChan2</code>的值为<code>nil</code>，那么它会被永远阻塞在有<code>for</code>关键字的那一行。</li>
</ul>
<p>这就是带<code>range</code>子句的<code>for</code>语句与通道的联用方式。不过，它是一种用途比较广泛的语句，还可以被用来从其他一些类型的值中获取元素。除此之外，Go语言还有一种专门为了操作通道而存在的语句：<code>select</code>语句。</p>
<p><strong>知识扩展</strong></p>
<p><strong>问题1：<code>select</code>语句与通道怎样联用，应该注意些什么？</strong></p>
<p><code>select</code>语句只能与通道联用，它一般由若干个分支组成。每次执行这种语句的时候，一般只有一个分支中的代码会被运行。</p>
<p><code>select</code>语句的分支分为两种，一种叫做候选分支，另一种叫做默认分支。候选分支总是以关键字<code>case</code>开头，后跟一个<code>case</code>表达式和一个冒号，然后我们可以从下一行开始写入当分支被选中时需要执行的语句。</p>
<p>默认分支其实就是default case，因为，当且仅当没有候选分支被选中时它才会被执行，所以它以关键字<code>default</code>开头并直接后跟一个冒号。同样的，我们可以在<code>default:</code>的下一行写入要执行的语句。</p>
<p>由于<code>select</code>语句是专为通道而设计的，所以每个<code>case</code>表达式中都只能包含操作通道的表达式，比如接收表达式。</p>
<p>当然，如果我们需要把接收表达式的结果赋给变量的话，还可以把这里写成赋值语句或者短变量声明。下面展示一个简单的例子。</p>
<pre><code>// 准备好几个通道。
intChannels := [3]chan int{
	make(chan int, 1),
	make(chan int, 1),
	make(chan int, 1),
}
// 随机选择一个通道，并向它发送元素值。
index := rand.Intn(3)
fmt.Printf(&quot;The index: %d\n&quot;, index)
intChannels[index] &lt;- index
// 哪一个通道中有可取的元素值，哪个对应的分支就会被执行。
select {
case &lt;-intChannels[0]:
	fmt.Println(&quot;The first candidate case is selected.&quot;)
case &lt;-intChannels[1]:
	fmt.Println(&quot;The second candidate case is selected.&quot;)
case elem := &lt;-intChannels[2]:
	fmt.Printf(&quot;The third candidate case is selected, the element is %d.\n&quot;, elem)
default:
	fmt.Println(&quot;No candidate case is selected!&quot;)
}
</code></pre>
<p>我先准备好了三个类型为<code>chan int</code>、容量为<code>1</code>的通道，并把它们存入了一个叫做<code>intChannels</code>的数组。</p>
<p>然后，我随机选择一个范围在[0, 2]的整数，把它作为索引在上述数组中选择一个通道，并向其中发送一个元素值。</p>
<p>最后，我用一个包含了三个候选分支的<code>select</code>语句，分别尝试从上述三个通道中接收元素值，哪一个通道中有值，哪一个对应的候选分支就会被执行。后面还有一个默认分支，不过在这里它是不可能被选中的。</p>
<p>在使用<code>select</code>语句的时候，我们首先需要注意下面几个事情。</p>
<ol>
<li>如果像上述示例那样加入了默认分支，那么无论涉及通道操作的表达式是否有阻塞，<code>select</code>语句都不会被阻塞。如果那几个表达式都阻塞了，或者说都没有满足求值的条件，那么默认分支就会被选中并执行。</li>
<li>如果没有加入默认分支，那么一旦所有的<code>case</code>表达式都没有满足求值条件，那么<code>select</code>语句就会被阻塞。直到至少有一个<code>case</code>表达式满足条件为止。</li>
<li>还记得吗？我们可能会因为通道关闭了，而直接从通道接收到一个其元素类型的零值。所以，在很多时候，我们需要通过接收表达式的第二个结果值来判断通道是否已经关闭。一旦发现某个通道关闭了，我们就应该及时地屏蔽掉对应的分支或者采取其他措施。这对于程序逻辑和程序性能都是有好处的。</li>
<li><code>select</code>语句只能对其中的每一个<code>case</code>表达式各求值一次。所以，如果我们想连续或定时地操作其中的通道的话，就往往需要通过在<code>for</code>语句中嵌入<code>select</code>语句的方式实现。但这时要注意，简单地在<code>select</code>语句的分支中使用<code>break</code>语句，只能结束当前的<code>select</code>语句的执行，而并不会对外层的<code>for</code>语句产生作用。这种错误的用法可能会让这个<code>for</code>语句无休止地运行下去。</li>
</ol>
<p>下面是一个简单的示例。</p>
<pre><code>intChan := make(chan int, 1)
// 一秒后关闭通道。
time.AfterFunc(time.Second, func() {
	close(intChan)
})
select {
case _, ok := &lt;-intChan:
	if !ok {
		fmt.Println(&quot;The candidate case is closed.&quot;)
		break
	}
	fmt.Println(&quot;The candidate case is selected.&quot;)
}
</code></pre>
<p>我先声明并初始化了一个叫做<code>intChan</code>的通道，然后通过<code>time</code>包中的<code>AfterFunc</code>函数约定在一秒钟之后关闭该通道。</p>
<p>后面的<code>select</code>语句只有一个候选分支，我在其中利用接收表达式的第二个结果值对<code>intChan</code>通道是否已关闭做了判断，并在得到肯定结果后，通过<code>break</code>语句立即结束当前<code>select</code>语句的执行。</p>
<p>这个例子以及前面那个例子都可以在demo24.go文件中被找到。你应该运行下，看看结果如何。</p>
<p>上面这些注意事项中的一部分涉及到了<code>select</code>语句的分支选择规则。我觉得很有必要再专门整理和总结一下这些规则。</p>
<p><strong>问题2：<code>select</code>语句的分支选择规则都有哪些？</strong></p>
<p>规则如下面所示。</p>
<ol>
<li>对于每一个<code>case</code>表达式，都至少会包含一个代表发送操作的发送表达式或者一个代表接收操作的接收表达式，同时也可能会包含其他的表达式。比如，如果<code>case</code>表达式是包含了接收表达式的短变量声明时，那么在赋值符号左边的就可以是一个或两个表达式，不过此处的表达式的结果必须是可以被赋值的。当这样的<code>case</code>表达式被求值时，它包含的多个表达式总会以从左到右的顺序被求值。<br />
<br></li>
<li><code>select</code>语句包含的候选分支中的<code>case</code>表达式都会在该语句执行开始时先被求值，并且求值的顺序是依从代码编写的顺序从上到下的。结合上一条规则，在<code>select</code>语句开始执行时，排在最上边的候选分支中最左边的表达式会最先被求值，然后是它右边的表达式。仅当最上边的候选分支中的所有表达式都被求值完毕后，从上边数第二个候选分支中的表达式才会被求值，顺序同样是从左到右，然后是第三个候选分支、第四个候选分支，以此类推。<br />
<br></li>
<li>对于每一个<code>case</code>表达式，如果其中的发送表达式或者接收表达式在被求值时，相应的操作正处于阻塞状态，那么对该<code>case</code>表达式的求值就是不成功的。在这种情况下，我们可以说，这个<code>case</code>表达式所在的候选分支是不满足选择条件的。<br />
<br></li>
<li>仅当<code>select</code>语句中的所有<code>case</code>表达式都被求值完毕后，它才会开始选择候选分支。这时候，它只会挑选满足选择条件的候选分支执行。如果所有的候选分支都不满足选择条件，那么默认分支就会被执行。如果这时没有默认分支，那么<code>select</code>语句就会立即进入阻塞状态，直到至少有一个候选分支满足选择条件为止。一旦有一个候选分支满足选择条件，<code>select</code>语句（或者说它所在的goroutine）就会被唤醒，这个候选分支就会被执行。<br />
<br></li>
<li>如果<code>select</code>语句发现同时有多个候选分支满足选择条件，那么它就会用一种伪随机的算法在这些分支中选择一个并执行。注意，即使<code>select</code>语句是在被唤醒时发现的这种情况，也会这样做。<br />
<br></li>
<li>一条<code>select</code>语句中只能够有一个默认分支。并且，默认分支只在无候选分支可选时才会被执行，这与它的编写位置无关。<br />
<br></li>
<li><code>select</code>语句的每次执行，包括<code>case</code>表达式求值和分支选择，都是独立的。不过，至于它的执行是否是并发安全的，就要看其中的<code>case</code>表达式以及分支中，是否包含并发不安全的代码了。</li>
</ol>
<p>我把与以上规则相关的示例放在demo25.go文件中了。你一定要去试运行一下，然后尝试用上面的规则去解释它的输出内容。</p>
<p><strong>总结</strong></p>
<p>今天，我们先讲了单向通道的表示方法，操作符“<code>&lt;-</code>”仍然是关键。如果只用一个词来概括单向通道存在的意义的话，那就是“约束”，也就是对代码的约束。</p>
<p>我们可以使用带<code>range</code>子句的<code>for</code>语句从通道中获取数据，也可以通过<code>select</code>语句操纵通道。</p>
<p><code>select</code>语句是专门为通道而设计的，它可以包含若干个候选分支，每个分支中的<code>case</code>表达式都会包含针对某个通道的发送或接收操作。</p>
<p>当<code>select</code>语句被执行时，它会根据一套<strong>分支选择规则</strong>选中某一个分支并执行其中的代码。如果所有的候选分支都没有被选中，那么默认分支（如果有的话）就会被执行。注意，发送和接收操作的阻塞是分支选择规则的一个很重要的依据。</p>
<p><strong>思考题</strong></p>
<p>今天的思考题都由上述内容中的线索延伸而来。</p>
<ol>
<li>如果在<code>select</code>语句中发现某个通道已关闭，那么应该怎样屏蔽掉它所在的分支？</li>
<li>在<code>select</code>语句与<code>for</code>语句联用时，怎样直接退出外层的<code>for</code>语句？</li>
</ol>
<p><a href="https://github.com/hyper0x/Golang_Puzzlers">戳此查看Go语言专栏文章配套详细代码。</a></p>
<p><img src="https://static001.geekbang.org/resource/image/35/48/358e4e8578a706598e18a7dfed3ed648.jpg" alt="" /></p>

                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">精选留言</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/21/b8/aca814dd.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">江山如画</span>
                            </div>
                            <div class="bd">感觉方法应该挺多，就看解决的是不是优雅<br><br>第一个问题：发现某个channel被关闭后，为了防止再次进入这个分支，可以把这个channel重新赋值成为一个长度为0的非缓冲通道，这样这个case就一直被阻塞了：<br>for {<br>		select {<br>		case _, ok := &lt;-ch1:<br>			if !ok {<br>				ch1 = make(chan int)<br>			}<br>		case ..... :<br>			&#47;&#47;&#47;&#47;<br>		default:<br>			&#47;&#47;&#47;&#47;	<br>		}<br>	}<br><br>第二个问题：可以用 break和标签配合使用，直接break出指定的循环体，或者goto语句直接跳转到指定标签执行<br><br>break配合标签：<br><br>ch1 := make(chan int, 1)<br>	time.AfterFunc(time.Second, func() { close(ch1) })<br>loop:<br>	for {<br>		select {<br>		case _, ok := &lt;-ch1:<br>			if !ok {<br>				break loop<br>			}<br>			fmt.Println(&quot;ch1&quot;)<br>		}<br>	}<br>	fmt.Println(&quot;END&quot;)<br><br>goto配合标签：<br><br>ch1 := make(chan int, 1)<br>	time.AfterFunc(time.Second, func() { close(ch1) })<br>	for {<br>		select {<br>		case _, ok := &lt;-ch1:<br>			if !ok {<br>				goto loop<br>			}<br>			fmt.Println(&quot;ch1&quot;)<br>		}<br>	}<br>loop:<br>	fmt.Println(&quot;END&quot;) <br></div>
                            <span class="time">2018-09-05 09:12</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/57/27/805786be.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">笨笨</span>
                            </div>
                            <div class="bd">谢谢赫老师今日分享，回答问题如下<br>1.对于select中被close的channel判断其第二个boolean参数，如果是false则被关闭，那么赋值此channel为nil，那么每次到这个nil的channel就会阻塞，select会忽略阻塞的通道，如果再搭配上default就一定能保证不会被阻塞了。<br>2.通过定义标签，配合goto或者break能实现在同一个函数内任意跳转，故可以跳出多层嵌套的循环。 <br></div>
                            <span class="time">2018-09-05 11:05</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>作者回复</span></div>
                                <p class="reply-content">你的问题是什么？</p>
                                <p class="reply-time">2018-09-06 14:39</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/75/6f/8a6e0a14.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">任性😀</span>
                            </div>
                            <div class="bd">demo24里边少了rand.Seed(time.Now().Unix())，不然每次随机数都是固定的顺序 <br></div>
                            <span class="time">2018-09-25 17:59</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/01/be/be358cab.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Kennedy</span>
                            </div>
                            <div class="bd">通道的类型如果是方法，性能会差吗？ <br></div>
                            <span class="time">2018-09-10 08:25</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/dd/d0/36b6eaf7.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">许森森</span>
                            </div>
                            <div class="bd">1 发现channel是closed之后，重新make，使得为nil，保证一直 阻塞。<br><br>		i := 0<br>		for {<br>			select {<br>			case _, ok := &lt;-c:<br>				if !ok {<br>					c = make(chan bool)<br>					fmt.Println(&quot;!ok&quot;)<br>				} else {<br>					fmt.Println(&quot;c:&quot;, c)<br>				}<br>			default:<br>				time.Sleep(1e9) &#47;&#47; 等待1秒钟<br>				fmt.Println(&quot;default, &quot;, i)<br>				i = i + 1<br>				if i &gt; 3 {<br>					return<br>				}<br>			}<br>		}<br>2 <br>return 直接退出程序<br>break loop &#47;&#47; 结合loop，会退出for循环<br>goto end &#47;&#47;结合end，跳转<br><br>	&#47;&#47;在select语句与for语句联用时，怎样直接退出外层的for语句?<br>	tick := time.Tick(100 * time.Millisecond)<br>	boom := time.After(500 * time.Millisecond)<br>	&#47;&#47;loop:<br>	for {<br>		select {<br>		case &lt;-tick:<br>			fmt.Println(&quot;tick.&quot;)<br>		case &lt;-boom:<br>			fmt.Println(&quot;BOOM!&quot;)<br>			&#47;&#47; return  &#47;&#47;直接退出程序<br>			&#47;&#47;break loop &#47;&#47; 结合loop，会退出for循环<br>			goto end &#47;&#47;结合end<br>		default:<br>			fmt.Println(&quot;    .&quot;)<br>			time.Sleep(50 * time.Millisecond)<br>		}<br>	}<br><br>end:<br>	fmt.Println(&quot;END...&quot;)<br> <br></div>
                            <span class="time">2018-09-14 00:25</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/12/7b/5da66a2f.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">啵啵</span>
                            </div>
                            <div class="bd">第一个问题，如果判断到chan关闭，即取到的第二个值为false。则将该chan赋值为nil。<br>第二个问题，根据情况使用goto或者return。或者加一个是否结束的标识，goto然后用两个break。 <br></div>
                            <span class="time">2018-09-11 08:21</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/65/42/76eb78bd.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">heha37</span>
                            </div>
                            <div class="bd">当第二个boolean参数为false的时候，在相应的case中设置chan为nil零值，再次case求值的时候会遭遇阻塞，会屏蔽该case。 <br></div>
                            <span class="time">2018-11-05 17:34</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>作者回复</span></div>
                                <p class="reply-content">是的。</p>
                                <p class="reply-time">2018-11-06 13:04</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/33/7a/ac307bfc.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">到不了的塔</span>
                            </div>
                            <div class="bd">郝老师，请问第一题的答案是啥，不知道怎么屏蔽分支呢 <br></div>
                            <span class="time">2018-10-24 08:47</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>作者回复</span></div>
                                <p class="reply-content">设置为nil就可以了。</p>
                                <p class="reply-time">2018-11-06 13:35</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">一步</span>
                            </div>
                            <div class="bd">老师你上面的发送通道&lt;-是代表，可以向通道中发送数据呢？那对于通道而言是不是就是，通道接收数据，叫做接收通道? <br></div>
                            <span class="time">2018-09-14 19:45</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>作者回复</span></div>
                                <p class="reply-content">只能向它发送数据的我简称为发送通道。</p>
                                <p class="reply-time">2018-09-15 09:27</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/54/6d/c947ef55.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Neo</span>
                            </div>
                            <div class="bd">请问老师： <br>select 分支选择规则中第5个：&quot;如果select语句发现同时有多个候选分支满足选择条件，那么它就会用一种伪随机算法在这些分支中选择一个执行&quot;   随机选一个执行 那我们是不是就不能确定程序会执行哪一条与语句了？<br><br> <br></div>
                            <span class="time">2018-09-12 23:42</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>作者回复</span></div>
                                <p class="reply-content">这种情况下是这样。</p>
                                <p class="reply-time">2018-09-15 09:40</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/95/ff/033caa38.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">michael</span>
                            </div>
                            <div class="bd">第二个问题，可以将for select写到一个函数里面，用return的方式来跳出for循环 <br></div>
                            <span class="time">2018-09-09 00:59</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/cb/67/5a3f9ae8.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">王腾飞</span>
                            </div>
                            <div class="bd">如何动态的调整select的channel，比如我能否select一个channel切片，然后根据需要调整切片的内容？ <br></div>
                            <span class="time">2018-09-08 07:35</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>作者回复</span></div>
                                <p class="reply-content">切片不是并发安全的，在这种场景下最好不要用。</p>
                                <p class="reply-time">2018-09-08 13:49</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/99/c9/a7c77746.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">冰激凌的眼泪</span>
                            </div>
                            <div class="bd">单向通道乍看没什么作用，但是看了后面文章，看到在函数传参、返回时可以通过双向通道的退化形成单向通道，就明白作者说的约束行为的意义了。 <br></div>
                            <span class="time">2018-09-07 09:09</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">有铭</span>
                            </div>
                            <div class="bd">我感觉那个只发不收和只收不发的通道，还是没啥用啊 <br></div>
                            <span class="time">2018-09-06 09:16</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>作者回复</span></div>
                                <p class="reply-content">设计API的时候很有用。</p>
                                <p class="reply-time">2018-09-06 14:34</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/88/d5/1e8fccab.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">癫狂的小兵</span>
                            </div>
                            <div class="bd">请问当select语句发现多个分支满足条件时随机选择一个分支执行 那怎样让其他满足条件的分支执行呢？ for 循环 等待下一次循环时再执行？  <br></div>
                            <span class="time">2018-09-05 11:50</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>作者回复</span></div>
                                <p class="reply-content">放在for循环里每次也是随机的，不过可以用for循环，或者再次执行select语句。</p>
                                <p class="reply-time">2018-09-06 14:38</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/13/33/7a/ac307bfc.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">到不了的塔</span>
                            </div>
                            <div class="bd">select有一个分支被唤醒后，会有多长的时间继续监听其他分支的唤醒，然后在执行case分支。<br>intChannels := [3]chan int{<br>		make(chan int, 1),<br>		make(chan int, 1),<br>		make(chan int, 1),<br>	}<br><br>	time.AfterFunc(5, func() {<br>		intChannels[1] &lt;- 1<br>	})<br>	time.AfterFunc(5000, func() {   &#47;&#47;时间为500时，就变为了intChannels[2]被唤醒了<br>		intChannels[2] &lt;- 2<br>	})<br>	select {<br>	case &lt;-intChannels[0]:<br>		fmt.Println(&quot;The first channel is ready&quot;)<br>	case &lt;-intChannels[1]:<br>		fmt.Println(&quot;The second channel is ready &quot;)<br>	case &lt;-intChannels[2]:<br>		fmt.Println(&quot;The third channel is ready&quot;)<br>	} <br></div>
                            <span class="time">2018-10-24 09:02</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/4c/0c/12b70610.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">我盼乙卯</span>
                            </div>
                            <div class="bd">老师你好，这节课，还没看但是买了你的GO并发编程，借宝地问老师一个问题，第四章的loadgen代码里，有一个函数如下：<br>&#47;&#47; genLoad 会发生载荷并向承受方发送。<br>func (gen *myGenerator) genLoad(throttle &lt;-chan time.Time) {<br>	for {<br>		select {<br>		case &lt;- gen.ctx.Done():<br>			gen.prepareToStop(gen.ctx.Err())<br>			return<br>		default:<br>		}<br><br>		gen.asyncCall()<br><br>		if gen.lps &gt; 0 {<br>			select {<br>				case&lt;-throttle:<br>				case&lt;-gen.ctx.Done():<br>					gen.prepareToStop(gen.ctx.Err())<br>					return<br>				default:<br>					&#47;&#47;fmt.Println(&quot;DD&quot;)<br>			}<br>		}<br>	}<br>}<br><br>最后这个default：<br>本来在老师的代码里没有，我无意中加上了。<br>结果加不加这个default：执行的结果完全是两个，天差地别，老师如果有时间，请在这里加上这一行代码default: test一下，本来是success 5000多个，结果加上之后，call error 1000，succuess 40000多，timeout2000多，实在不明白为何会这样，谢谢老师。 <br></div>
                            <span class="time">2018-10-23 12:35</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/46/5b/dd4be9de.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">蜗牛</span>
                            </div>
                            <div class="bd">func main() {<br>	ch1 := make(chan int64, 3)<br>	ch1 &lt;- 100<br><br>	ch2 := make(chan int64, 3)<br>	close(ch2)<br><br>	for {<br>		select {<br>		case v1 := &lt;-ch1:<br>			fmt.Println(v1)<br>		case _, isOpen := &lt;-ch2:<br>			if !isOpen {<br>				ch2 = nil<br>			}<br>		default:<br>			goto next<br>		}<br>	}<br><br>next:<br>	fmt.Println(&quot;The Programe is over&quot;)<br>} <br></div>
                            <span class="time">2018-09-15 15:31</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/44/3e/8f13b074.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Gavin</span>
                            </div>
                            <div class="bd">单向通道可以实现事件监听 <br></div>
                            <span class="time">2018-09-12 09:36</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/12/52/78/4365471c.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Forever</span>
                            </div>
                            <div class="bd">老师请问如果我是100个管道并行读入1亿的数字 然后100个管道分别去调用判断数字是否是质数的函数 然后本来运行着好好的cpu占用率到了99  后来突然不再运算了 cpu也直接占用率骤降到5% 但是程序没有报错而是暂停不动 请问老师是什么原因 <br></div>
                            <span class="time">2018-09-10 21:47</span>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>